## 前言：redis 服务器解读
1. 命令请求执行过程
>1、客户端发送命令；客户端将用户输入命令转换成协议格式，然后通过连接到服务器的套接字，将请求发送给服务器  
>2、服务器读取命令；读取套接字中协议格式的命令，存入客户端状态的输入缓存区；分析命令，提取命令参数和参数个数，存入客户端状态；调用命令执行器，执行命令  
2. 命令执行器
```
命令表值redisCommand结构定义
struct redisCommand{
    name char*;//命令名称
    arity int;命令参数格式;
    sflags char*;//标识值，命令属性（是否允许读或者写等等）
    flags int;//二进制标识
    calls long long;//执行次数
    millseconds long long;//执行总时长
}
```
>1、根据客户端状态里argv[0]参数，在命令表（字典）查找，并将找到的命令保存到客户端状态cmd属性  
>2、执行预备操作：检查客户端状态cmd是否指向NULL（命令是否存在）；根据cmd执行结构里arity属性，检查参数个数是否正确（检查参数）；检查身份验证；检查内存占用情况；  
>3、调用命令的实现函数
```
client->cmd->proc(client);
```
>被调用的函数会执行指定操作，并产生相应的命令回复，这些回复会保存在客户端状态的输出缓存区，之后函数会为客户端套接字关联回复处理器，这个处理器将命令回复返回客户端  
>4、执行后续工作：添加慢日志；更新redisCommand结构里的millseconds和calls属性；添加AOF缓存区；主从复制  
5. serverCron函数
> 1、更新服务器时间缓存  unixtime mstime  
> 2、更新Lau时钟  lruclock，计算每个键的空转时间  
> 3、更新服务器每秒执行命令次数 
> 4、更新内存峰值记录 stat_peak_memory  
> 5、处理SIGTERRM信号，打开服务器状态 shutdown_assp标识  1 关闭服务器 0 不做动作  
> 6、管理客户端资源 调用clientCron函数：计算客户端空转时长，释放客户端；释放客户端上次输入缓存区，重建缓存区  
> 7、管理数据库资源 调用databasesCron函数：定期删除，字典收缩  
> 8、执行被延迟的BGREWRITEAOF 
> 9、检查持久化操作的状态  服务器状态 rbd_child_pid aof_child_pid记录命令子进程ID，只要其中的值不为-1，服务器就执行一次wait3函数  
> 10、将AOF缓存区内容写入AOF文件  
> 11、关闭异步客户端（关闭超过输出缓存区大小）  
> 12、增加cronloops计数器的值  
6. 初始化服务器
>1、初始化服务器状态结构 执行initServerConfig函数  
>2、载入配置项(优先命令参数)  
>3、初始化服务器结构  
>4、还原数据库状态，载入RDB或者AOF文件，还原数据  
>5、执行事件循环
