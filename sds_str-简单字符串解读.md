## 前言：本文是对redis 简单字符串数据结构SDS读后解读

1. SDS定义
```
struct sdshdr {
  int len;//buf数组中已使用字节长度，等于sds字符串保存的长度
  int free;//buf数组中未使用的字节的数量
  char buf[];//，字节数组，保留字符串
}
```
2. SDS与字符串的比较
 * 2.1 SDS遵循c字符串已空格符结尾的习惯，方便重用部分c字符串函数
 * 2.2 获取字符串长度由O(N)降为O(1),(直接读取SDS的属性len，设置和更新均由底层api处理)
 * 2.3 空间预分配和惰性空间释放，free属性的应用（减少了修改字符串带来的内存分配次数和缓存区溢出）
 * 2.4 二进制安全，已len属性来判断是否结尾而不是空字符，buf[]保留二进制数据
 * 2.5 兼容部分c字符串函数
3. 空间预分配
```
1. 当操作SDS api的时候，进行修改，并且需要扩展空间时，程序不仅会为SDS修改分配必须的空间，还会为SDS分配额外的未使用空间
2. 公式1：当修改时，SDS的len的值小于1MB，那么程序会分配和len值一样的未使用空间，也就是free = len
3. 公式2：当修改时，SDS的len的值大于1MB，那么程序会分配固定1MB的未使用空间
4. 通过空间预分配策略，减少操作字符串增长时候的内存分配次数
5. 扩展SDS空间时，会先判断free是否足够，如果足够就直接使用，不需要重新分配内存
```
4. 惰性空间释放
```
1、当操作SDS 缩短api时，不会立即释放缩短后的字节空间，而是先用free属性存储起来，等待将来使用
2. 避免了缩短字符串时所需的内存重分配的操作，同时为了将来可能有的增长操作进行优化
```
5. 使用场景
```
字符串类型
```
